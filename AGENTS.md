# AGENTS.md

## Назначение репозитория
Репозиторий содержит Lua-скрипты игр Pixel Quest для выполнения в GopherLua (Lua 5.1 + `goto`). Игры 2D, система координат: **(0,0) в левом верхнем углу**, ось X — вправо, ось Y — вниз.

## Обязательные методы скрипта игры
В движке требуется полный набор методов, описанный в `blank_game` (интерпретатор падает, если что-то отсутствует).

<!-- TODO: Сверить точный список обязательных методов в wiki/blank_game и обновить список ниже при необходимости. -->

Базовый список (см. `template_v1/template_v1.lua`):
- `StartGame(gameJson, gameConfigJson)` — инициализация и старт.
- `NextTick()` — игровой тик; возвращает результат игры при завершении.
- `RangeFloor(setPixel, setButton)` — снапшот пола/кнопок.
- `GetStats()` — статистика для табло.
- `PauseGame()` / `ResumeGame()` — пауза/возобновление.
- `SwitchStage()` — принудительное переключение этапа.
- `PixelClick(click)` — нажатия на пиксель.
- `ButtonClick(click)` — нажатия на кнопку.
- `DefectPixel(defect)` — дефектовка пикселя.
- `DefectButton(defect)` — дефектовка кнопки.

**Завершение игры**: использовать `SendGameResult` (метод завершения игры в интерпретаторе).

<!-- TODO: Уточнить сигнатуру и правила использования SendGameResult по wiki/движку. -->

## Полезные материалы в репозитории
- `README.md` — обзор проекта, ссылки на Wiki и список механик.
- `template_v1/template_v1.lua` — эталонный шаблон с комментариями и структурой API.
- `SCOREBOARDS.md` — варианты табло (через `ScoreboardVariant` в статистике).
- `AUDIO.md` — загрузка/управление аудиофайлами для наборов звуков.

<!-- TODO: Добавить краткие выдержки из Wiki (ссылки, ключевые термины, правила API), когда будет доступна. -->

## Avonlib (avonlib.lua)
Библиотека с утилитами и базовой инфраструктурой игры. Основные элементы:
- Таймеры:
  - `AL.NewTimer(delayMs, callback)` — запланировать таймер.
  - `AL.CountTimers(deltaMs)` — обновлять таймеры каждый тик.
- NFZ (NoFeetZone) — зоны недоступных/статичных пикселей:
  - `AL.RoomHasNFZ(tGame)` / `AL.LoadNFZInfo()`.
  - `AL.IsPixelInNFZ` / `AL.IsRectInNFZ`.
- Цвета:
  - `AL.LoadColors()` — загрузка палитры из `tGame.Colors` либо дефолтной.

<!-- TODO: Проверить и описать остальные разделы avonlib.lua (Rules/Audio/Video и т.д.) если они используются в новых механиках. -->

## Шаблоны
- `template_v1/template_v1.lua` — минимальный шаблон без avonlib.
- `avon_template/avon_template.lua` — шаблон с `require("avonlib")` и более развитым каркасом (таймеры, NFZ, фазы игры).

## Примечания по данным игры
`game.json` и `config.json` предоставляют поля `Cols`, `Rows`, `Buttons` и другие параметры комнаты/игры.

<!-- TODO: Уточнить перечень полей game.json/config.json из wiki и добавить сюда краткую шпаргалку. -->
